<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<chapter id="walkthrough">
  <title>New User Walkthrough</title>
  
  <section>
  
   <title> Walkthrough Objectives</title>
    <para>Describe the subject of the sample project that the user will be assembling.

    The user will use an abstract workflow, convert it to an executable workflow, plan it and execute it, and then monitor the workflow execution.
     </para>
    
   <para><emphasis>Walkthrough Subjects:</emphasis></para>
   
   <itemizedlist>
      <listitem>
        <para>Download and Install Pegasus VM</para>
      </listitem>
      
       <listitem>
        <para>Workflows</para>
      </listitem>

      <listitem>
        <para>Pegasus Plan and Pegasus-run</para>
      </listitem>
      
      <listitem>
        <para>Monitoring and Debugging</para>
      </listitem>
      
      <listitem>
        <para>Plotting and Statistics</para>
      </listitem>
      
      <listitem>
        <para>Environments</para>
      </listitem>
      
      <listitem>
        <para>Advanced Exercises</para>
        
      </listitem>


</itemizedlist>

  </section>
  
    <section>
     <title>Downloading and Running the VM using Virtual Box</title>

    <para>You will need to have Virtual Box to run the virtual machine on
    your computer. If you do not already have it installed, download the binary versions and install them from the<ulink
    url="http://www.virtualbox.org/wiki/Downloads"> Virtual Box
    Website</ulink> .</para>


    <section>
      <title>Download the VM for Virtual Box use</title>

      <para>Download the corresponding disk image.</para>

      <itemizedlist>
        <listitem>
          <para><ulink
          url="http://pegasus.isi.edu/wms/download/3.0/Pegasus-3.0.1-Debian-6-x86.vbox.tar.bz2"
          xml:base="">Virtual Box Pegasus Image</ulink></para>

          <para>It is around <emphasis role="bold">1.2 GB</emphasis> in size.
          We recommend using a command line tool like <emphasis
          role="bold">wget</emphasis> to download the image. Downloading the
          image using the browser sometimes corrupts the image.</para>

          <programlisting>$ <emphasis role="bold">wget http://pegasus.isi.edu/wms/download/3.0/Pegasus-3.0.1-Debian-6-x86.vbox.tar.bz2

</emphasis> http://pegasus.isi.edu/wms/download/3.0/Pegasus-3.0.1-Debian-6-x86.vbox.tar.bz2
           =&gt; `Pegasus-3.0.1-Debian-6-x86.vbox.tar.bz2'
Resolving pegasus.isi.edu... 128.9.64.219
Connecting to pegasus.isi.edu|128.9.64.219|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1,336,554,492 (1.2G) [application/x-bzip2]
</programlisting>

          <para>The Image is bzipped . You will need to unzip it.</para>

          <para>If you have gnu tar you can do this directly</para>

          <programlisting><emphasis role="bold">$ gtar jxvf Pegasus-3.0.1-Debian-6-x86.vbox.tar.bz2</emphasis></programlisting>

          <para>Else you need to do the following</para>

          <programlisting><emphasis role="bold">$ bunzip2 Pegasus-3.0.1-Debian-6-x86.vbox.tar.bz2

$ tar xvf Pegasus-3.0.1-Debian-6-x86.vbox.tar</emphasis></programlisting>

          <para>After untarring a folder named<emphasis role="bold">
          Pegasus-3.0.1-Debian-6-x86.vbox</emphasis> will be created that has
          the vmdk files for the VM.</para>
        </listitem>
      </itemizedlist>
    </section>

    <section>
      <title>Running the VM with Virtual Box</title>

      <para>Follow these steps to add the vmdk file to Virtual Box and create a virtual machine inside the Virtual
      Box</para>

          <section>
           <para>1. Launch Virtual Box on your machine.</para>

        
        <para><figure id="virtualboxhome">
        <title>Virtualbox Home</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="images/VirtualBoxHome.png"
                       valign="middle" />
          </imageobject>
        </mediaobject>
      </figure></para>
           </section>
           <section>
          <para>2. In the Icon Menu, select <emphasis role="bold">New</emphasis></para>


          <para>The Create New Virtual Machine Wizard Welcome window opens up.</para>

        <para><figure id="welcome">
        <title>Welcome Window</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="images/Wizard1.png"
                       valign="middle" />
          </imageobject>
        </mediaobject>
      </figure></para>

          <para>3. Select <emphasis role="bold">Next</emphasis></para>
          </section>
         <para><figure id="selectvm">
        <title>VM Name and OS Type</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="images/Wizard3.png"
                       valign="middle" />
          </imageobject>
        </mediaobject>
      </figure></para>

          <para>4. Enter a name for the virtual machine.</para>
          <para>5. Select <emphasis role="bold">Linux</emphasis> as the <emphasis role="bold">Operating System</emphasis> and
          <emphasis role="bold">Debian</emphasis>as the <emphasis role="bold">Version</emphasis>
          from the pull down menus. Select <emphasis role="bold">Next</emphasis></para>
           <para><figure id="namevm">
        <title>Base Memory</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="images/Wizard4.png"
                       valign="middle" />
          </imageobject>
        </mediaobject>
      </figure></para>


          <para>6. Select the base recommended <emphasis role="bold">Base Memory Size</emphasis>
          then select <emphasis role="bold">Next</emphasis></para>


         <para>7.Navigate to the location of the <emphasis role="bold">Debian-6-86</emphasis> file
         downloaded earlier. Once a file has been selected, it is available in the pull down menu.</para>
         
        <para><figure id="selectfile">
        <title>Document Library</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="images/Wizard6.png"
                       valign="middle" />
          </imageobject>
        </mediaobject>
      </figure></para>


         <para>8. Double click the <emphasis role="bold">Debian-6-86 </emphasis> file to launch the Create New Virtual Disk Wizard.</para>
          <para><figure id="doclib">
        <title/>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="images/Wizard7.png"
                       valign="middle" />
          </imageobject>
        </mediaobject>
      </figure></para>
          <para>9. Select <emphasis role="bold">Next</emphasis></para>
          
          <para><figure id="virtdisk">
        <title>Storage Type</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="images/Wizard8.png"
                       valign="middle" />
          </imageobject>
        </mediaobject>
      </figure></para>

        
        
        <para>10. Select the desired storage type then select <emphasis role="bold">Next</emphasis></para>
          <para><figure id="virtdisklocation">
        <title>Virtual Disk Location and Size</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="images/Wizard9.png"
                       valign="middle" />
          </imageobject>
        </mediaobject>
      </figure></para>

         <para>10. Select the desired location and virtual disk size, then select <emphasis role="bold">Next</emphasis></para>
          <para><figure id="summary">
        <title>Summary</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="images/Wizard10.png"
                       valign="middle" />
          </imageobject>
        </mediaobject>
      </figure></para>

         <para>11. Review the settings and select <emphasis role="bold">Finish</emphasis> to create
         the virtual disk or <emphasis role="bold">Cancel</emphasis> to cancel creation</para>
         
         <para>The VM is created and will appear in the VirtualBox Manager window in a powered off state</para>

         <para><figure id="virtboxpopulated">
        <title>Storage Type</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="images/VirtualBoxPopulated.png"
                       valign="middle" />
          </imageobject>
        </mediaobject>
      </figure></para>
      
      <para>12. Double click the VM to launch the First Run Wizard</para>
      
      <para><figure id="firstrunwizard">
        <title>Storage Type</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="images/FirstRun1.png"
                       valign="middle" />
          </imageobject>
        </mediaobject>
      </figure></para>
      <para> Select <emphasis role="bold">Next</emphasis></para>
      
      
        <para>The Starting VM progress window opens and tracks the creation process</para>
        
        <para><figure id="progressbar">
        <title>Storage Type</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="images/FirstRun2.png"
                       valign="middle" />
          </imageobject>
        </mediaobject>
      </figure></para>
        <para>When completed the virtual home page page is displayed</para>
        
       <para><figure id="virthome">
        <title>Virtual Machine Running</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="images/VirtualHomePageLogged in.png"
                       valign="middle" />
          </imageobject>
        </mediaobject>
      </figure></para>
         <para>12. Select <emphasis role="bold">Accessories - LX Terminal</emphasis> to open a terminal window.</para>
         <para><figure id="virtdisk">
        <title>Select Terminal</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="images/SelectTerminal.png"
                       valign="middle" />
          </imageobject>
        </mediaobject>
      </figure></para>
      <para>The Terminal Window opens</para>
      
      <para><figure id="virtdisk">
        <title>Storage Type</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="images/VMCommandWindow.png"
                       valign="middle" />
          </imageobject>
        </mediaobject>
      </figure></para>


         <para>Note: The terminal window is the main interface for the walkthrough process.</para>


    </section>
    </section>

  <section>
     <title>Workflows</title>
     
      <para>Workflows are at the center of how Pegasus operates. Pegasus takes in an abstract workflow ( DAX ) and generates an executable workflow (DAG) that is
      run in an environment. For the purposes of this walkthrough, we will demonstrate the characteristics and structure of workflows by generating a workflow with
      a bit of Java code that uses the DAX API to generate a DAX workflow.

      For a more detailed description of workflows, how to create them, and how they are used in Pegasus please see <emphasis>Creating Workflows</emphasis> in the <link

      linkend="about">(Introduction)</link> chapter</para>






    <section>
     <title>Planning and Executing Workflows</title>
     <para>In this chapter you will be introduced to planning and executing a
    workflow through Pegasus WMS locally. You will then plan and execute a
    larger Montage workflow on the GRID.</para>

    <para>When the virtual machine starts , it will automatically log you in
    as user <emphasis role="bold">tutorial</emphasis> . The password for this
    account is <emphasis role="bold">pegasus</emphasis>.</para>

    <para>After logging on, start a terminal. There is a shortcut on the
    desktop for the terminal.</para>

    <programlisting><command>$ </command><emphasis role="bold">tutorial@pegasus-vm:$</emphasis><emphasis
        role="bold"> pwd</emphasis>

/home/tutorial
</programlisting>

    <para>In general, to run workflows on the Grid you will need to obtain
    Grid Credentials. The VM already has a user certificate installed for the
    pegasus user. To generate the proxy ( grid credentials ) run the <emphasis
    role="bold">grid-proxy-init</emphasis> command.</para>

    <programlisting><command>$ [pegasus@pegasus ~]$ grid-proxy-init

</command><computeroutput>Your identity: /O=edu/OU=ISI/OU=isi.edu/CN=Tutorial User
Creating proxy ............................................. Done
Your proxy is valid until: Thu Dec 23 22:41:36 2010


</computeroutput></programlisting>

    <para>All the exercises in this Chapter will be run from the
    $HOME/pegasus-wms/ directory. All the files that are required reside in
    this directory</para>

    <programlisting><command>$ cd $HOME/pegasus-wms</command></programlisting>

    <para>Files for the exercise are stored in subdirectories:</para>

    <programlisting><command>$ ls</command><computeroutput><computeroutput>

config  dax</computeroutput></computeroutput></programlisting>

    <para>You may also see some other files here.</para>

    <section>
      <title>Creating a DIAMOND DAX</title>

      <para>Generate a 4 node diamond dax with a small piece of java
      code that uses the DAX API to generate the DAX. Open the file
      $HOME/pegasus-wms/dax/CreateDAX.java in a file editor:</para>

      <programlisting><command>$ vi dax/CreateDAX.java</command></programlisting>

      <para>There is a function Diamond( String site_handle, String
      pegasus_location ) that constructs the DAX. Towards the end of the
      function there is some commented out code.</para>

      <programlisting> // Add analyze job
//To be uncommented for exercise 2.1

        Job j4 = new Job("j4", "pegasus", "analyze", "4.0");
        j4.addArgument("-a analyze -T 60 -i ").addArgument(fc1);
        j4.addArgument(" ").addArgument(fc2);
        j4.addArgument("-o ").addArgument(fd);
        j4.uses(fc1, File.LINK.INPUT);
        j4.uses(fc2, File.LINK.INPUT);
        j4.uses(fd, File.LINK.OUTPUT);

        //add job to the DAX
        dax.addJob(j4);

        //analyze job is a child to the findrange jobs
        dax.addDependency("j2", "j4");
        dax.addDependency("j3", "j4");

//End of commented out code for Exercise 2.1
</programlisting>

      <para>The above snippet of code, adds a job with the ID0000004 to the
      DAX. It illustrates how to specify</para>

      <orderedlist>
        <listitem>
          <para>the arguments for the job</para>
        </listitem>

        <listitem>
          <para>the logical files used by the job</para>
        </listitem>

        <listitem>
          <para>the dependencies to other jobs</para>
        </listitem>

        <listitem>
          <para>adding the job to the dax</para>
        </listitem>
      </orderedlist>

      <para>After uncommenting the code, compile and run the CreateDAX
      program.</para>

      <programlisting><emphasis role="bold">$ cd dax

$ javac -classpath .:/opt/pegasus/default/lib/pegasus.jar CreateDAX.java

$  java -classpath .:/opt/pegasus/default/lib/pegasus.jar CreateDAX local /opt/pegasus/default ./diamond.dax
</emphasis></programlisting>

      <para>Let us view the generated diamond.dax.</para>

      <programlisting><emphasis role="bold">$ cat diamond.dax</emphasis></programlisting>

      <para>Inside the DAX, you should see three sections.</para>

      <orderedlist>
        <listitem>
          <para>list of input file locations</para>
        </listitem>

        <listitem>
          <para>list of executable locations</para>
        </listitem>

        <listitem>
          <para>definition of all jobs - each job in the workflow. 4 jobs in
          total.</para>
        </listitem>

        <listitem>
          <para>list of control-flow dependencies - this section specifies a
          partial order in which jobs are to executed.</para>
        </listitem>
      </orderedlist>
     </section>





  
   <section>
    <title>Workflow Execution</title>
    
    <para>Describe in general how a workflow is executed.</para>
  
     <para>Links to new optimization page</para>
     
    </section>
 


<section>

     <title>Workflow Monitoring and Analysis</title>

                  <section>
                   <title>Monitoring Tools</title>

                   <para>Pegasus comes bundled with tools for monitoring and analyzing workflows</para>
                   
                   <orderedlist>
                       <listitem>
                         <para><emphasis>Pegaus Monitord</emphasis> - Tracks the job states as a workflow is executed</para>

                       </listitem>
                       <listitem>
                         <para><emphasis>Pegasus Status</emphasis> - Displays the status of the workflow individual jobs</para>

                       </listitem>
                       <listitem>
                         <para><emphasis>Pegaus Analyzer</emphasis> - Command line utility for parsing several workflow directory files to summarize useful information for the user</para>

                       </listitem>
                       <listitem>
                         <para><emphasis>Pegasus Remove</emphasis> - Comand line tool for aborting a workflow</para>

                       </listitem>

                      </orderedlist>
                      
                       <para> See
                           <link linkend="monitoring_debugging_stats"> "Monitoring Tools"</link>

                       </para>
</section>
       <section>
     <title>Debugging and Statistical Analysis of Workflows</title>


           <para>Pegasus comes bundled with tools for producing statistical system reports</para>

                        <orderedlist>
                        <listitem>
                           <para><emphasis>Pegasus Statistics</emphasis> - Generates workflow execution statistics</para>

                        </listitem>
                        <listitem>
                        <para><emphasis>Pegasus Plots</emphasis> - Generates graphs and charts to visusalize workflow execution</para>

                        </listitem>

                        </orderedlist>
                        <para> See
                       <link linkend="monitoring_debugging_stats"> "Plotting and Statistics Tools"</link>   </para>
                      </section>

   </section>
    </section>
  <section>
   <title>Pegasus Logs</title>
   <para>Describe the logs that Pegasus creates and what each is used for</para>
   <para>Include the persistence of each log and any storage repository for historical logs</para>
   
     <itemizedlist>
      <listitem>Log Number 1
       <para>Log details</para>    </listitem>
       
       <listitem>Log Number 2
       <para>Log details</para>    </listitem>

       <listitem>Log Number 3
       <para>Log details</para>    </listitem>

     </itemizedlist>
   
   
   </section>


   

   

    </section>

</chapter>




























