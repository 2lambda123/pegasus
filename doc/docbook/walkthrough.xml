<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<chapter id="walkthrough">
  <title>New User Walkthrough</title>
  
  <section>
  
   <title> Walkthrough Objectives</title>
    <para>

    Using an abstract workflow, a user will convert it to an executable workflow, plan it and execute it, and then monitor the workflow execution.
     </para>
    
   <para><emphasis>Walkthrough Subjects:</emphasis></para>
   
   <itemizedlist>
      <listitem>
        <para>Virtual Machine Image</para>
      </listitem>
      
       <listitem>
        <para>Workflows</para>
      </listitem>

      <listitem>
        <para>Pegasus Plan and Pegasus-run</para>
      </listitem>
      
      <listitem>
        <para>Monitoring and Debugging</para>
      </listitem>
      
      <listitem>
        <para>Plotting and Statistics</para>
      </listitem>
      
      <listitem>
        <para>Environments</para>
      </listitem>
      
      <listitem>
        <para>Advanced Exercises</para>
        
      </listitem>


</itemizedlist>

  </section>
  
    <section>
     <title>Downloading Virtual Box </title>

    <note>Virtual Box is required to run the virtual machine on
    your computer. If you do not already have it installed, download the binary version desired and install it from the<ulink
    url="http://www.virtualbox.org/wiki/Downloads"> Virtual Box
    Website</ulink> .</note>


    <section>
      <title>Download the VM Image</title>

      <para>Download the corresponding disk image.</para>

      <itemizedlist>
        <listitem>
          <para><ulink
          url="http://pegasus.isi.edu/wms/download/3.0/Pegasus-3.0.1-Debian-6-x86.vbox.tar.bz2"
          xml:base="">Virtual Box Pegasus Image</ulink></para>

          <para>It is around <emphasis role="bold">1.2 GB</emphasis> in size.
          We recommend using a command line tool like <emphasis
          role="bold">wget</emphasis> to download the image. Downloading the
          image using the browser sometimes corrupts the image.</para>

          <programlisting>$ <emphasis role="bold">wget http://pegasus.isi.edu/wms/download/3.0/Pegasus-3.0.1-Debian-6-x86.vbox.tar.bz2

</emphasis> http://pegasus.isi.edu/wms/download/3.0/Pegasus-3.0.1-Debian-6-x86.vbox.tar.bz2
           =&gt; `Pegasus-3.0.1-Debian-6-x86.vbox.tar.bz2'
Resolving pegasus.isi.edu... 128.9.64.219
Connecting to pegasus.isi.edu|128.9.64.219|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1,336,554,492 (1.2G) [application/x-bzip2]
</programlisting>

          <para>The Image is bzipped . You will need to unzip it.</para>

          <para>If you have <emphasis role="bold">gnu tar</emphasis> you can do this directly:</para>

          <programlisting><emphasis role="bold">$ gtar jxvf Pegasus-3.0.1-Debian-6-x86.vbox.tar.bz2</emphasis></programlisting>

          <para>If you do not have <emphasis role="bold">gnu tar</emphasis> ,you need to do the following:</para>

          <programlisting><emphasis role="bold">$ bunzip2 Pegasus-3.0.1-Debian-6-x86.vbox.tar.bz2

$ tar xvf Pegasus-3.0.1-Debian-6-x86.vbox.tar</emphasis></programlisting>

          <para>After untarring a folder named<emphasis role="bold">
          Pegasus-3.0.1-Debian-6-x86.vbox</emphasis> will be created that has
          the vmdk files for the VM.</para>
        </listitem>
      </itemizedlist>
    </section>
     <section>
     <title>Create the Virtual Machine</title>
     
    <para>Run the VM with Virtual Box (see <link linkend="useful_tips">Runnning VM with Virtual Box</link>) to create the virtual machine</para>

     </section>
    </section>

  <section>
     <title>Walkthrough Workflow</title>
     
      <para>Workflows are at the center of how Pegasus operates. Pegasus takes in an abstract workflow (DAX) and generates an executable workflow (DAG) that is
      run in an environment. For the purposes of this walkthrough, we will demonstrate the characteristics and structure of workflows by generating a workflow with
      a bit of Java code that uses the DAX API to generate a DAX workflow.

      For a detailed description of workflows, how to create them, and how they are used in Pegasus see  <link

      linkend="creating_workflows">Creating Workflows</link></para>


    <section>
     <title>Planning and Executing Workflows</title>
     <para>In this section you plan and execute a
    workflow through Pegasus WMS locally. You then plan and execute a
    larger Montage workflow on the GRID.</para>


    <para><emphasis role="bold">1. </emphasis> Open a terminal.</para>

    <para>In general, to run workflows on the Grid you will need to obtain
    Grid Credentials. The VM already has a user certificate installed for the
    pegasus user. <token/> <token/><parameter/></para>

    <para><emphasis role="bold">2.</emphasis> Run the <emphasis role="bold">grid-proxy-init</emphasis> command to generate the proxy (grid credentials).</para>

       <para><figure id="gridcreds">
        <title>Terminal Window</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="images/gridcreds.png"
                       valign="middle" />
          </imageobject>
        </mediaobject>
      </figure></para>
    

    <para>All the exercises in this Chapter will be run from the <emphasis role="bold">$HOME/pegasus-wms/ directory</emphasis>
    . All the files that are required reside in this directory. </para>
    
    <para><emphasis role="bold">3.</emphasis>  Change the directory to <emphasis role="bold">HOME/pegasus-wms:</emphasis> </para>

    <programlisting><command>$ cd $HOME/pegasus-wms</command></programlisting>

    <para>The files for the exercise are stored in the <emphasis role="bold">config</emphasis> and <emphasis role="bold">dax</emphasis> subdirectories:</para>

         <para><figure id="fileslocation">
        <title>File Location</title>

        <mediaobject>
          <imageobject>
            <imagedata align="center"
                       fileref="images/fileslocation.png"
                       valign="middle" />
          </imageobject>
        </mediaobject>
      </figure></para>


    <section>
      <title>Creating a DIAMOND DAX</title>

      <para>Use these instructions to generate a 4 node diamond dax with a small piece of java
      code that uses the DAX API to generate the DAX.</para>

      <para><emphasis role="bold">1.</emphasis>   Open the file:
      <emphasis role="bold">$HOME/pegasus-wms/dax/CreateDAX.java</emphasis></para>

      <programlisting><command>$ vi dax/CreateDAX.java</command></programlisting>

       <para><emphasis role="bold">2.</emphasis> Scroll down to the <emphasis role="bold">//Add analyze job //To be uncommented for exercise 2.1</emphasis> code near the end of the file. </para>
      


        <programlisting><command>// Add analyse job
        // To be uncommented for exercise 2.1
        /*
        Job j4 = new Job ("j4", "pegasus", "analyze", "4.0");
        j4.addArgument(" -a analyze -T 60 -i ").addArgument (fc1);
        j4.addArgument (" ").addArgument (fc2);
        j4.addArgument(" -o ").addArgument (fd);
        j4.uses(fc1, File.LINK.INPUT);
        j4.uses(fc2, FileLINK.INPUT);
        j4.uses(fd, File.LINK&gt;OUTPUT);
        
        //add job to the DAX
        dax.addJob (j4);
        
        //analyze job is a child to the findrange jobs
        dax.addDependency("j2", "j4");
        dax.addDependency("j3","j4");
        */
        //End of commented out code for Exercise 2.1
         </command></programlisting>


      <para>The above snippet of code, adds a job with the ID of <emphasis role="bold">0000004</emphasis>
       to the
      DAX. It illustrates how to specify:</para>

      <orderedlist>
        <listitem>
          <para>the arguments for the job</para>
        </listitem>

        <listitem>
          <para>the logical files used by the job</para>
        </listitem>

        <listitem>
          <para>the dependencies to other jobs</para>
        </listitem>

        <listitem>
          <para>adding the job to the dax</para>
        </listitem>
      </orderedlist>

      <para><emphasis role="bold">3.</emphasis> Uncomment the code, then compile and run the CreateDAX
      program as follows:</para>

      <programlisting><emphasis role="bold">$ cd dax

$ javac -classpath .:/opt/pegasus/default/lib/pegasus.jar CreateDAX.java

$  java -classpath .:/opt/pegasus/default/lib/pegasus.jar CreateDAX local /opt/pegasus/default ./diamond.dax
</emphasis></programlisting>

      <para><emphasis role="bold">4.</emphasis>  View the generated diamond.dax.</para>

      <programlisting><emphasis role="bold">$ cat diamond.dax</emphasis></programlisting>
      
      <para>The job output is displayed:</para>
      
       <programlisting><emphasis>
       <para>
        tutorial@pegasus-vm:~/pegasus-wms/dax$
       </para>
         ?xml version="1.0" encoding="UTF-8"?&gt;
         - -generated on 2011-05-28T19:32:02-07:00- -&gt;
          - -generated by: tutorial [ ?? } - -&gt;
          adag xmls="http://pegasus.isi.edu/schema/DAX" xmlns:xsi="http:/www/w3.org/20"
         01/XMLSchema-instance" xsi:schemaLocation="http:pegasus.isi.edu/schema/DAX ht
         tp://pegasus.isi.edu.schema/dax3.2.xsd" verion="3.2" name="blackdiamond" inde
         x="0" count="1"
        </emphasis></programlisting>
        
        
      <para>The DAX contains four sections.</para>


          <para><emphasis role="bold">Section 1. Files</emphasis> - Acts as a Replica Catalog</para>

          <para><emphasis role="bold">Section 2. Executables</emphasis> - Acts as a Transformation Catalog</para>

          <para><emphasis role="bold">Section 3. Transformations</emphasis> - Aggregates, Executables, and Files</para>

          <para><emphasis role="bold">Section 4. Jobs DAXs or DAGs</emphasis> - Defines a Job, DAX, or DAG</para>

     </section>




  
   <section>
    <title>Workflow Execution</title>
    
    <para>Workflows are submitted to <emphasis role="bold">pegasus-plan</emphasis> where an executable workflow is generated
    by querying the catalogs and performing refinement steps. </para>
         <para> See the Pegasus Plan section of the
                           <link linkend="running_workflows"> "Running Workflows"</link> chapter.

                       </para>
     
    </section>
 




                  <section>
                   <title>Workflow Monitoring and Analysis Tools</title>

                   <para>Pegasus comes bundled with tools for monitoring and analyzing workflows</para>
                   
                   <orderedlist>
                       <listitem>
                         <para><emphasis role="bold">Pegaus Monitord</emphasis> - Tracks the job states as a workflow is executed</para>

                       </listitem>
                       <listitem>
                         <para><emphasis role="bold">Pegasus Status</emphasis> - Displays the status of the workflow individual jobs</para>

                       </listitem>
                       <listitem>
                         <para><emphasis role="bold">Pegaus Analyzer</emphasis> - Command line utility for parsing several workflow directory files to summarize useful information for the user</para>

                       </listitem>
                       <listitem>
                         <para><emphasis role="bold">Pegasus Remove</emphasis> - Comand line tool for aborting a workflow</para>

                       </listitem>

                      </orderedlist>
                      
                       <para> See
                           <link linkend="monitoring_debugging_stats"> "Monitoring Tools"</link>

                       </para>

       <section>
     <title>Debugging and Statistical Analysis of Workflows</title>


           <para>Pegasus comes bundled with tools for producing statistical system reports</para>

                        <orderedlist>
                        <listitem>
                           <para><emphasis role="bold">Pegasus Statistics</emphasis> - Generates workflow execution statistics</para>

                        </listitem>
                        <listitem>
                        <para><emphasis role="bold">Pegasus Plots</emphasis> - Generates graphs and charts to visusalize workflow execution</para>

                        </listitem>

                        </orderedlist>
                        <para> See
                       <link linkend="monitoring_debugging_stats"> "Plotting and Statistics Tools"</link>   </para>
                      </section>

   </section>
    </section>



   

   

    </section>

</chapter>









































