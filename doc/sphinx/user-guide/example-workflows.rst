.. _example-workflows:

=================
Example Workflows
=================

PegasusHub is a gallery of Pegasus workflows created and published by 
Pegasus' user community. PegasusHub is located at 
``https://pegasushub.github.io/`` and contains workflows ranging from
simple examples that are suitable for beginners (e.g., Diamond Workflow)
to more complicated examples showcasing more advanced Pegasus capabilities
(e.g., Montage Workflow). All of the workflows available on PegasusHub
reside in individual GitHub repositories and can be cloned using Git.

From the available workflows on PegasusHub we have cherry picked
some of the examples and through a cli tool called ``pegasus-init`` we
enable users to fetch them in a ready to execute state on some of the
most common execution environments Pegasus supports.

.. note::

  These examples are intended to be a starting point for when you want
  to create your own workflows and want to see how other workflows are
  set up. The example workflows might not work in your
  environment without modifications. Site and transformation catalogs
  may contain site and user specifics such as paths to scratch directories
  and installed software, and minor modificiations might be
  required to get the workflows to plan and run.

.. _pegasushub:

PegasusHub
==========

Contributing Workflows
----------------------

Any user can contribute its Pegasus workflow to PegasusHub! In order to add
your own Pegasus-enabled workflow GitHub repository, you will need to
submit a pull request to PegasusHub's development repository
(``https://github.com/pegasushub/pegasushub.github.io``) and suggest an
edit to the ``_data/workflows.yml`` file with your workflow repository
details.

::

  -organization: your-github-organization
   repo_name: your-workflow-repository

Diamond Workflow
----------------

The diamond workflow (``https://github.com/pegasus-isi/diamond-workflow``)
has 4 nodes, layed out in a diamond shape, with files being
passed between them (f.*):

Merge Workflow
--------------

Process Workflow
----------------

Pipeline Workflow
-----------------

Split Workflow
--------------

.. _pegasus-init:

Pegasus Init
============

Pegasus Init (``pegasus-init``) is designed to be an interactive cli tool that generates example
workflows, ready to be executed on common execution environments. The
example workflows provided are a subset of the workflows availabe at
PegasusHub (``https://pegasushub.github.io``).


.. note::

  Some of the example workflows might overwrite the configuration ``pegasus-init``
  generates. Be cautious when executing commands that may alter the
  workflow and catalogs generated by ``pegasus-init``.


Being an interactive cli tool, ``pegasus-init`` prompts the user for input,
asking questions that will customize the selected execution environment.

Example usage:

::

  pegasus-init example-workflow


``pegasus-init`` first asks you to select one of the execution environments.

::

  ###########################################################
  ###########   Available Execution Environments   ##########
  ###########################################################
  1) Local Machine Condor Pool
  2) Local SLURM Cluster
  3) Local LSF Cluster
  4) OLCF Summit from OLCF Headnode
  5) OLCF Summit from OLCF Hosted Kubernetes Pod
  
  select an execution environment [1]:


Afterwards, it asks you to select one of the available workflow examples
offered for the selected execution environment


::

  ###########################################################
  ###########     Available Workflow Examples      ##########
  ###########################################################
  1) pegasus-isi/diamond-workflow
  2) pegasus-isi/merge-workflow
  3) pegasus-isi/pipeline-workflow
  4) pegasus-isi/process-workflow
  5) pegasus-isi/split-workflow
  
  Select an example workflow [1]:


Based on your answers ``pegasus-init`` might ask more questions
in order to customize the execution environment's configuration
such as your project allocation, the scheduler's queue etc.

.. _pegasus-init-exec-envs:

Pegasus Init Execution Environments
===================================

The execution environemnts supported by ``pegasus-init`` are updated dynamically
and their source code can be found at the GitHub repository
``https://github.com/pegasushub/pegasus-site-catalogs``. The python script
``Sites.py`` is used by ``pegasus-init`` to generate the appropriate site
catalog for a supported execution environment, but it's also standalone and 
it can be used to scaffold a Pegasus site catalog.

::

  python3 Sites.py \
    --execution-site CONDORPOOL \
    --project-name "" \
    --queue-name "" \
    --pegasus-home "" \
    --scratch-parent-dir ~/scratch \
    --storage-parent-dir ~/storage

  
.. note::

  Use ``-h|--help`` to discover more iformation about the input arguments.
