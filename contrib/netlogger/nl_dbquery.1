.TH nl_dbquery 1 "Aug 5 2008" "version $Id: nl_dbquery 896 2008-07-29 20:47:03Z dang $" "USER COMMANDS"
.SH NAME
nl_dbquery \- A script for running user defined queries on a database (generated by netlogger or otherwise).
.SH SYNOPSIS
nl_dbquery runs queries on a database using the various parameters supplied on the command line or via a configuration file.
.SH DESCRIPTION
nl_dbquery is a script for running user defined queries on a database.
The query file takes various command line parameters as user input and queries the database according to the user defined queries and input parameters. The queries to be executed should be written in a config file which nl_dbquery will read. The queries in the config file are generalised so that the database connection and other specific parameters are separated from the actual query statements themselves. This way these parameters can be changed without having a need to change the queries themselves. 

.SH OPTIONS
.TP
\fB\-\-version
show program's version number and exit
.TP
\fB\-h \fB\-\-help
show this help message and exit
.TP
\fB\-c FILE \fB\-\-config=FILE
 Read configuration from FILE. Default=./nl_dbquery.conf.The configuration file should follow the syntax in this file for it to be successfully parsed by the script. The configuration file is forreading the query information and other parameters from a database.Its also used for automatically generating a part of the help message itself.
.TP
\fB\-d DB_NAME \fB\-\-db=DB_NAME
 Database to connect to. Default=pegasus
.TP
\fB\-l \fB\-\-list
This generates a numbered list of the availablequeries reading the query information from the configfile
.TP
\fB\-n \fB\-\-dry\-run
Display but don't run the query
.TP
\fB\-p DB_PARAM \fB\-\-param=DB_PARAM
 Database connection parameters (full path to the filename in case of a sqlite database or a host name in case of MySql). The host name for MySQL should be of the form mysql://hostname while for SQLite it should be of the form sqlite:///path/to/filename. This parameter is a required parameterexcept in case when the script is executed just with the -l/--list option to list the available queries.
.TP
\fB\-P QUERY_PARAM \fB\-\-query\-param=QUERY_PARAM
 Parameter for the given query, in the form 'name=value'. The 'value' is substituted for occurrences of '<name>' in the query string. May be repeated.
.TP
\fB\-q QUERY \fB\-\-query=QUERY
 Run QUERY, which can be a number or name. Use -l/--list to list available queries
.TP
\fB\-u URI \fB\-\-uri=URI
Database connection URI, where the database module name is used as the URI scheme. MySQL requires a host and sqlite requires a filename.
.TP
\fB\-v \fB\-\-verbose
Repeat up to 3 times for more verbose logging. The default level is ERROR 
.SS Time Range:
The following start/end times for the query accept many date
expressions like 'yesterday', '2 weeks 1 day ago', 'last wed', 'Jan
4', etc. A more complete list is: <N> weeks|days|hours|minutes|seconds
ago, today, now, tomorrow, yesterday, 4th [[Jan] 2003], Jan 4th 2003,
mm/dd/yyyy (preferred), dd/mm/yyyy, yyyy-mm-dd, yyyymmdd, next
Tuesday, last Tuesday

.TP
\fB\-s START \fB\-\-start=START
 Start date for the query ['1 week ago'].
.TP
\fB\-e END \fB\-\-end=END
End date for the query ['today'].



.SH USAGE
.TP
\fBConfiguration File 
.PP
This is part of a sample configuration file which gives information about different sections and their usage:

[DEFAULT]
# put defaults here
# These are the query sections

[how_many_jobs]
   desc = "How many jobs ran on a given day"
   query = "select count(id) from event where TIMERANGE and name = 'pegasus.invocation';"

[jobs_on_hosts]
   desc = "How many jobs ran on given hosts" 
   query = "select count(id), value from event join attr on e_id = id where event.name = 'pegasus.invocation' and attr.name = 'host' group by value;"


[DEFAULT] has all the default values/paarmeters to be used by the queries
To add a new query to the configuration file add that section like [how_may_jobs] above

desc: is a description of the query which will be read by the -l/--list option

query: this is the actual query statement.The values of the TIMERANGE parameter can be substituted at the runtime from the command line (see -s/--start and -e/--end option for more information)



.SH EXAMPLES
.TP
.B nl_dbquery -c filename -p mysql://localhost -d dbname -q 1 -s "3 weeks ago" -e "1 week 2 days ago" 
.PP
Description of what this example does:
This example runs the script on a configuration file named filename for a MySQL database running at localhost. The name of the database is dbname and the query to be executed is query 1. The start date for the query is "3 weeks ago" while the end date for it is "1 week 2 days ago"
.SH EXIT STATUS
nl_dbquery returns 0 on success and a non-zero value on failure. 
.SH BUGS
No known bugs.
.SH AUTHOR
Binit S Bhatia (bsbhatia (at) lbl.gov)
.SH SEE ALSO
NetLogger home page
.RS
http://acs.lbl.gov/NetLoggerWiki
.RE

