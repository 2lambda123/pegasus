[tox]

; Test for py26, py27, py35, py36, py37, py38
envlist  = py35


[testenv]

commands     = pytest --cov Pegasus {posargs} Pegasus/test

passenv      = USER CPATH

setenv       = PYTHONUNBUFFERED   = yes
               PYTHONHASHSEED     = 1649596107

skip_install = {env:SKIP_INSTALL:False}

deps         = pytest
               pytest-mock
               coverage
               pytest-cov
               jsonschema
               pyOpenSSL


[testenv:py26]

deps         = pytest==3.2.5
               pyOpenSSL==0.14


[testenv:lint]

basepython   = python3.6

skipsdist    = True

skip_install = True

commands     = isort --recursive --check-only {toxinidir}
               black --target-version py35 --check {toxinidir}
               flake8 {toxinidir}

deps         = isort
               black
               flake8
               pydocstyle


[testenv:docs]

changedir    = ../../../doc/docbook

whitelist_externals = make

commands_pre = sphinx-apidoc     --force  --output-dir python {toxinidir}              {toxinidir}/{setup,test}.py {toxinidir}/Pegasus/{cluster,command,compat,exitcode,init,s3,submitdir,user}.py {toxinidir}/Pegasus/{test,db,monitoring,catalogs,cli,netlogger,plots_stats,service,tools}
               javasphinx-apidoc --update --output-dir java   {toxinidir}/../../../src {toxinidir}/../../../src/edu/isi/pegasus/aws/batch/common/

commands     = make html man

skipsdist    = True

skip_install = True

deps         = sphinx
               recommonmark
               sphinx_rtd_theme
               sphinxcontrib-openapi
               javasphinx
               sphinx_tabs


[coverage:run]

omit         = Pegasus/test/*
