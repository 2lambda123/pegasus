<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<chapter id="walkthrough_doc">
  <title>Pegasus Walkthrough</title>
  
  <section>
  
   <title> Walkthrough Objectives</title>
    <para>Describe the sample project that the user will be assembling, what the objectives are, and what the user will be able to do after completing the walkthrough</para>
    
    </section>
    
  <section>

   <title>Overview of Walkthrough Steps</title>
   
   <itemizedlist>
      <listitem>
        <para>Download and Install Pegasus VM</para>
      </listitem>
      
       <listitem>
        <para>Workflows</para>
      </listitem>

      <listitem>
        <para>Pegasus Plan and Pegasus-run</para>
      </listitem>
      
      <listitem>
        <para>Monitoring and Debugging</para>
      </listitem>
      
      <listitem>
        <para>Plotting and Statistics</para>
      </listitem>
      
      <listitem>
        <para>Environments</para>
      </listitem>
      
      <listitem>
        <para>Advanced Exercises</para>
        
      </listitem>


</itemizedlist>

  </section>
  
  <section>
    <title>Downloading and Running the VM using Virtual Box</title>

    <para>You will need to install Virtual Box to run the virtual machine on
    your computer. If you already have one of the tools installed, use that.
    Otherwise download the binary versions and install them from the<ulink
    url="http://www.virtualbox.org/wiki/Downloads"> Virtual Box
    Website</ulink> .</para>


    <section>
      <title>Download the VM for Virtual Box use</title>

      <para>Download the corresponding disk image.</para>

      <itemizedlist>
        <listitem>
          <para><ulink
          url="http://pegasus.isi.edu/wms/download/3.0/Pegasus-3.0.1-Debian-6-x86.vbox.tar.bz2"
          xml:base="">Virtual Box Pegasus Image</ulink></para>

          <para>It is around <emphasis role="bold">1.2 GB</emphasis> in size.
          We recommend using a command line tool like <emphasis
          role="bold">wget</emphasis> to download the image. Downloading the
          image using the browser sometimes corrupts the image.</para>

          <programlisting>$ <emphasis role="bold">wget http://pegasus.isi.edu/wms/download/3.0/Pegasus-3.0.1-Debian-6-x86.vbox.tar.bz2

</emphasis> http://pegasus.isi.edu/wms/download/3.0/Pegasus-3.0.1-Debian-6-x86.vbox.tar.bz2
           =&gt; `Pegasus-3.0.1-Debian-6-x86.vbox.tar.bz2'
Resolving pegasus.isi.edu... 128.9.64.219
Connecting to pegasus.isi.edu|128.9.64.219|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1,336,554,492 (1.2G) [application/x-bzip2]
</programlisting>

          <para>The Image is bzipped . You will need to unzip it.</para>

          <para>If you have gnu tar you can do this directly</para>

          <programlisting><emphasis role="bold">$ gtar jxvf Pegasus-3.0.1-Debian-6-x86.vbox.tar.bz2</emphasis></programlisting>

          <para>Else you need to do the following</para>

          <programlisting><emphasis role="bold">$ bunzip2 Pegasus-3.0.1-Debian-6-x86.vbox.tar.bz2

$ tar xvf Pegasus-3.0.1-Debian-6-x86.vbox.tar</emphasis></programlisting>

          <para>After untarring a folder named<emphasis role="bold">
          Pegasus-3.0.1-Debian-6-x86.vbox</emphasis> will be created that has
          the vmdk files for the VM.</para>
        </listitem>
      </itemizedlist>
    </section>

    <section>
      <title>Running the VM with Virtual Box</title>

      <para>Launch Virtual Box on your machine. Follow the steps to add the
      vmdk file to Virtual Box and create a virtual machine inside the Virtual
      Box</para>

      <orderedlist>
        <listitem>
          <para>In the Menu, click File and select Virtual Media Manager (
          File &gt; Virtual Media Manager )</para>
        </listitem>

        <listitem>
          <para>The Virtual Media Manager Windows opens up.</para>
        </listitem>

        <listitem>
          <para>Click on "Add" button to add the<emphasis role="bold">
          Pegasus-3.0.1-Debian-6-x86.vbox/Debian-6-x86.vmdk</emphasis> file
          that you just downloaded and unzipped.</para>
        </listitem>

        <listitem>
          <para>You will now see the Debian-6-x86.vmdk in the list of hard
          disks with Actual size listed as around 3.0 GB</para>
        </listitem>

        <listitem>
          <para>Close the Window for the Virtual Media Manager</para>
        </listitem>
      </orderedlist>

      <para>We will now create a Virtual Machine in the Virtual Box.</para>

      <orderedlist>
        <listitem>
          <para>In the Menu, click Machine and select New ( Machine &gt; New
          )</para>
        </listitem>

        <listitem>
          <para>It will open the New Virtual Machine Wizard. Click
          Continue</para>
        </listitem>

        <listitem>
          <para>In the VM Name and OS Type Window specify the name as<emphasis
          role="bold"> PegasusVM-3.0</emphasis>.1 Select the <emphasis
          role="bold">Operating System as Linux </emphasis>and <emphasis
          role="bold">Version as Debian </emphasis>. Click Continue.</para>
        </listitem>

        <listitem>
          <para>Set the base memory to <emphasis role="bold">384 MB</emphasis>
          . It defaults to 512 MB. Click Continue</para>
        </listitem>

        <listitem>
          <para>We now select the Virtual Hard Disk to use with the machine.
          Select the option box for Use Existing Hard Disk. Select <emphasis
          role="bold">Debian-6-x86.vmdk</emphasis> from the list . Click
          Continue</para>
        </listitem>

        <listitem>
          <para>Click Done</para>
        </listitem>

        <listitem>
          <para>Now in the Virtual Box , start the PegasusVM-3.0.1
          machine.</para>
        </listitem>
      </orderedlist>
    </section>
    

  <section>
     <title>Workflows</title>
     
      <para>Workflows are at the center of how Pegasus operates. Pegasus takes in an abstract workflow ( DAX ) and generates an executable workflow (DAG) that is
      run in an environment. For the purposes of this walkthrough, we will demonstrate the characteristics and structure of workflows by generating a workflow with
      a bit of Java code that uses the DAX API to generate a DAX workflow.

      For a more detailed description of workflows, how to create them, and how they are used in Pegasus please see <link

      linkend="workflow_types">(Workflows)</link></para>



    </section>

  <section>
     <title>Planning and Executing Workflows</title>
     <para>In this chapter you will be introduced to planning and executing a
    workflow through Pegasus WMS locally. You will then plan and execute a
    larger Montage workflow on the GRID.</para>

    <para>When the virtual machine starts , it will automatically log you in
    as user <emphasis role="bold">tutorial</emphasis> . The password for this
    account is <emphasis role="bold">pegasus</emphasis>.</para>

    <para>After logging on, start a terminal. There is a shortcut on the
    desktop for the terminal.</para>

    <programlisting><command>$ </command><emphasis role="bold">tutorial@pegasus-vm:$</emphasis><emphasis
        role="bold"> pwd</emphasis>

/home/tutorial
</programlisting>

    <para>In general, to run workflows on the Grid you will need to obtain
    Grid Credentials. The VM already has a user certificate installed for the
    pegasus user. To generate the proxy ( grid credentials ) run the <emphasis
    role="bold">grid-proxy-init</emphasis> command.</para>

    <programlisting><command>$ [pegasus@pegasus ~]$ grid-proxy-init

</command><computeroutput>Your identity: /O=edu/OU=ISI/OU=isi.edu/CN=Tutorial User
Creating proxy ............................................. Done
Your proxy is valid until: Thu Dec 23 22:41:36 2010


</computeroutput></programlisting>

    <para>All the exercises in this Chapter will be run from the
    $HOME/pegasus-wms/ directory. All the files that are required reside in
    this directory</para>

    <programlisting><command>$ cd $HOME/pegasus-wms</command></programlisting>

    <para>Files for the exercise are stored in subdirectories:</para>

    <programlisting><command>$ ls</command><computeroutput><computeroutput>

config  dax</computeroutput></computeroutput></programlisting>

    <para>You may also see some other files here.</para>

    <section>
      <title>Creating a DIAMOND DAX</title>

      <para>Generate a 4 node diamond dax with a small piece of java
      code that uses the DAX API to generate the DAX. Open the file
      $HOME/pegasus-wms/dax/CreateDAX.java in a file editor:</para>

      <programlisting><command>$ vi dax/CreateDAX.java</command></programlisting>

      <para>There is a function Diamond( String site_handle, String
      pegasus_location ) that constructs the DAX. Towards the end of the
      function there is some commented out code.</para>

      <programlisting> // Add analyze job
//To be uncommented for exercise 2.1

        Job j4 = new Job("j4", "pegasus", "analyze", "4.0");
        j4.addArgument("-a analyze -T 60 -i ").addArgument(fc1);
        j4.addArgument(" ").addArgument(fc2);
        j4.addArgument("-o ").addArgument(fd);
        j4.uses(fc1, File.LINK.INPUT);
        j4.uses(fc2, File.LINK.INPUT);
        j4.uses(fd, File.LINK.OUTPUT);

        //add job to the DAX
        dax.addJob(j4);

        //analyze job is a child to the findrange jobs
        dax.addDependency("j2", "j4");
        dax.addDependency("j3", "j4");

//End of commented out code for Exercise 2.1
</programlisting>

      <para>The above snippet of code, adds a job with the ID0000004 to the
      DAX. It illustrates how to specify</para>

      <orderedlist>
        <listitem>
          <para>the arguments for the job</para>
        </listitem>

        <listitem>
          <para>the logical files used by the job</para>
        </listitem>

        <listitem>
          <para>the dependencies to other jobs</para>
        </listitem>

        <listitem>
          <para>adding the job to the dax</para>
        </listitem>
      </orderedlist>

      <para>After uncommenting the code, compile and run the CreateDAX
      program.</para>

      <programlisting><emphasis role="bold">$ cd dax

$ javac -classpath .:/opt/pegasus/default/lib/pegasus.jar CreateDAX.java

$  java -classpath .:/opt/pegasus/default/lib/pegasus.jar CreateDAX local /opt/pegasus/default ./diamond.dax
</emphasis></programlisting>

      <para>Let us view the generated diamond.dax.</para>

      <programlisting><emphasis role="bold">$ cat diamond.dax</emphasis></programlisting>

      <para>Inside the DAX, you should see three sections.</para>

      <orderedlist>
        <listitem>
          <para>list of input file locations</para>
        </listitem>

        <listitem>
          <para>list of executable locations</para>
        </listitem>

        <listitem>
          <para>definition of all jobs - each job in the workflow. 4 jobs in
          total.</para>
        </listitem>

        <listitem>
          <para>list of control-flow dependencies - this section specifies a
          partial order in which jobs are to executed.</para>
        </listitem>
      </orderedlist>
    </section>



    </section>

  <section>
    <title>Setting Up Environments</title>
    
    <para>Describe what an environment is and the general set up steps required.</para>
  
                   <section>
                         <title>Catalog Basics</title>

                         <para> NOT SURE WHAT THE END USER NEEDS RIGHT HERE</para>

                 <link
      linkend="components">See Catalog Details</link>
                       </section>
                       
                       <section>
                          <title>Setting Up a Local Environment</title>
                          
                          <para>Specific Steps</para>


                       </section>
                       <section>
                          <title>Setting Up a Grid Environment</title>

                          <para>Specific Steps</para>

                        <section>
                          <title>Setting Up a Condor Pools Environment</title>

                          <para>Specific Steps</para>


                         </section>
                         </section>
                       <section>
                          <title>Setting Up a Glidein Environment</title>

                          <para>Specific Steps</para>


                       </section>
                       <section>
                       <title>Setting Up a Cloud Environment</title>

                          <para>Specific Steps</para>


                       </section>

     </section>
  
  <section>
    <title>Workflow Execution</title>
    
    <para>Describe in general how a workflow is executed.</para>
  
     <para>Links to new optimization page</para>
     
   </section>
 

  <section>
     <title>Executing Workflows in Different Environments</title>
               <section>
               <title>Local Execution</title>

               </section>
               
               <section>
               <title>Condor Pools and Glidelins</title></section>
               
               <section>
               <title>Grids</title>
               
               </section>


               <section>
                <title>Clouds</title>

               </section>

   </section>
  <section>

   <title>Workflow Monitoring and Analysis</title>

                  <section>
                   <title>Monitoring Tools</title>

                   <para>List the tools and link to each tools page</para>




                  </section>

  </section>

  <section>

   <title>Setting up your own Pegasus Installation</title>

    <para>Not sure what goes here</para>
  </section>

  <section>
   <title>Pegasus Logs</title>
   <para>Describe the logs that Pegasus creates and what each is used for</para>
   <para>Include the persistence of each log and any storage repository for historical logs</para>
   
   
   </section>
  
  <section>
    <title>Debugging and Statistical Analysis of Workflows</title>
    <para>Describe each debugging tool used on workflows</para>
   
    <para>Describe the Statistical Analysis Reports and what they indicate</para>
   
   </section>
   
  <section>
  
   <title>Planning Steps</title>
   <para>List the general planning steps that are performed on a workflow</para>
   
  <link
      linkend="api">See Pegasus API</link>


   </section>
  

  <section>
    <title>Glossary</title>
  
     <para>List of terms in Glossary format and a link to the term in the documentation </para>
  
  </section>
  </section>


</chapter>
















