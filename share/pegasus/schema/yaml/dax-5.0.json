{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "file:///Users/ryantanaka/ISI/pegasus/share/pegasus/schema/yaml/dax-5.0.json",
    "$def": {
        "metadata": {
            "type": "object",
            "patternProperties": {
                "[a-zA-Z0-9\\._]+": { "type": "string" },
                "^x-": { "$ref": "common.json#/$def/vendorExtension" }
            },
            "minProperties": 1,
            "additionalProperties": false
        },

        "eventType": {
            "enum": [
                "never",
                "start",
                "error",
                "success",
                "end",
                "all"
            ]
        },

        "shellHook": {
            "type": "object",
            "properties": {
                "on": { "$ref": "#/$def/eventType" },
                "cmd": { "type": "string" }
            },
            "additionalProperties": false,
            "required": ["cmd", "on"]
        },

        "hooks": {
            "type": "object",
            "properties": {
                "shell": {
                    "type": "array",
                    "items": { "$ref": "#/$def/shellHook" },
                    "minItems": 0
                }
            },
            "additionalProperties": false,
            "patternProperties": {
              "^x-": { "$ref": "common.json#/$def/vendorExtension" }
            }
        },

        "transformation": {
            "type": "object",
            "properties": {
                "name": { "type": "string" },
                "namespace": { "type": "string" },
                "version": { "$ref": "common.json#/$def/versionString" },
                "uses": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "lfn": { "type": "string" },
                            "namespace": { "type": "string" },
                            "version": { "$ref": "common.json#/$def/versionString" },
                            "isExecutable": { "type": "boolean" }
                        },
                        "required": ["name"],
                        "additionalProperties": false
                    },
                    "minItems": 1
                },
                "hooks": { "$ref": "#/$def/hooks" }
            },
            "required": ["name"],
            "additionalProperties": false,
            "patternProperties": {
              "^x-": { "$ref": "common.json#/$def/vendorExtension" }
            }
        },

        "linkType": {
            "enum": [
                "none",
                "input",
                "output",
                "inout"
            ]
        },

        "abstractJob": {
            "type": "object",
            "properties": {
                "id": { "$ref": "common.json#/definitions/nodeIdString" },
                "nodeLabel" : { "type": "string" },
                "argument": {
                    "type": "array",
                    "items": { "type": "string" },
                    "minItems": 0
                },
                "stdin": {
                    "type": "object",
                    "properties": {
                        "name": { "type": "string" }
                    },
                    "required": ["name"],
                    "additionalProperties": false
                },
                "stdout": {
                    "type": "object",
                    "properties": {
                        "name": { "type": "string" }
                    },
                    "required": ["name"],
                    "additionalProperties": false
                },
                "stderr": {
                    "type": "object",
                    "properties": {
                        "name": { "type": "string" }
                    },
                    "required": ["name"],
                    "additionalProperties": false
                },
                "uses": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "lfn": { "type": "string" },
                            "type": { "$ref": "#/definitions/linkage_type" },
                            "optional": { "type": "boolean" },
                            "register": { "type": "boolean" },
                            "stageOut": {
                                "enum": ["true", "false", "optional"]
                            },
                            "size": { "type": "string" },
                            "namespace": { "type": "string" },
                            "version": { "$ref": "common.json#/$def/versionString" },
                            "executable": { "type": "boolean" }
                        },
                        "required": ["lfn"]
                    }
                },
                "profiles": { "$ref": "#/definitions/profiles" },
                "invoke": { "$ref": "#/definitions/invoke" }
            },
            "required": ["id"]
        },

        "job": {
            "type": "object",
            "properties": {
                "name": { "type": "string" },
                "namespace": { "type": "string" },
                "version": { "$ref": "common.json#/$def/versionString" }
            },
            "anyOf": [{ "$ref": "#/definitions/abstract_job" }],
            "required": ["name"]
        },

        "dag": {
            "type": "object",
            "properties": {
                "file": { "type": "string" }
            },
            "anyOf": [{ "$ref": "#/definitions/abstract_job" }],
            "required": ["file"]
        },

        "dax": {
            "type": "object",
            "properties": {
                "file": { "type": "string" }
            },
            "anyOf": [{ "$ref": "#/definitions/abstract_job" }],
            "required": ["file"]
        },

        "child": {
            "type": "object",
            "properties": {
                "id": { "ref": "common.json#/definitions/nodeIdString" },
                "parents": {
                    "type": "array",
                    "items": { "$ref": "common.json#/definitions/nodeIdString" }
                }
            }
        }
    },

    "type": "object",
    "properties": {
        "name": { "$ref": "#/definitions/filenameSafeString" },
        "version": { "$ref": "common.json#/$def/versionString" },
        "hooks": { "$ref": "#/$def/hooks" },

        "sites": {
            "oneOf": [
                { "$ref": "sc-5.0.json" },
                {
                    "properties": {
                        "$ref": {
                            "type": "string",
                            "format": "iri"
                        }
                    }
                }
            ]
        },

        "replicas": {
            "oneOf": [
                { "$ref": "rc-5.0.json" },
                {
                    "properties": {
                        "$ref": {
                            "type": "string",
                            "format": "iri"
                        }
                    }
                }
            ]
        },

        "transformations": {
            "oneOf": [
                {
                    "type": "array",
                    "items": { "$ref": "tc-5.0.json#/$def/transformation" },
                    "minItems": 1
                },
                {
                    "properties": {
                        "$ref": {
                            "type": "string",
                            "format": "iri"
                        }
                    }
                }
            ]
        },

        "jobs": {
            "type": "array",
            "items": {
                "anyOf": [
                    { "$ref": "#/definitions/job" },
                    { "$ref": "#/definitions/dag" },
                    { "$ref": "#/definitions/dax" }
                ]
            },
            "minItems": 1
        },

        "children": {
            "type": "array",
            "items": { "$ref": "#/definitions/child" },
            "minItems": 0
        }
    },
    "required": ["name", "version", "jobs"]
}
