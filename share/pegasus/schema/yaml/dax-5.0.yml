.yml$schema: 'http://json-schema.org/draft-07/schema#'
$id: 'file:///Users/ryantanaka/ISI/pegasus/share/pegasus/schema/yaml/dax-5.0.yml'
$defs:
  metadata:
    type: object
    patternProperties:
      '[a-zA-Z0-9\._]+':
        type: string
      ^x-:
        $ref: 'common.yml#/$defs/vendorExtension'
    minProperties: 1
    additionalProperties: false

  linkType:
    enum:
      - none
      - input
      - output
      - inout

  abstractJob:
    type: object
    properties:
      id:
        $ref: 'common.yml#/$defs/nodeIdString'
      nodeLabel:
        type: string
      argument:
        type: array
        items:
          type: string
        minItems: 0
      stdin:
        type: object
        properties:
          name:
            type: string
        required:
          - name
        additionalProperties: false
      stdout:
        type: object
        properties:
          name:
            type: string
        required:
          - name
        additionalProperties: false
      stderr:
        type: object
        properties:
          name:
            type: string
        required:
          - name
        additionalProperties: false
      uses:
        type: array
        items:
          type: object
          properties:
            lfn:
              type: string
            type:
              $ref: '#/$defs/linkType'
            optional:
              type: boolean
            registerReplica:
              type: boolean
            stageOut:
                type: boolean
            size:
              type: string
            namespace:
              type: string
            version:
              $ref: 'common.yml#/$defs/versionString'
            executable:
              type: boolean
          required:
            - lfn
      profiles:
        $ref: '#/$defs/profiles'
      hooks:
        $ref: 'common.yml#/$defs/hooks'
    required:
      - id

  job:
    allOf:
      - $ref: '#/$defs/abstractJob'
      - properties:
          name:
            type: string
          namespace:
            type: string
          version:
            $ref: 'common.yml#/$defs/versionString'
        required:
          - name

  dag:
    allOf:
      - $ref: '#/$defs/abstractJob'
      - properties:
          file:
            type: string
        required:
          - file

  dax:
    allOf:
      - $ref: '#/$defs/abstractJob'
      - properties:
          file:
            type: string
        required:
          - file

  parent:
    type: object
    properties:
      id:
        ref: 'common.yml#/$defs/nodeIdString'
      children:
        type: array
        items:
          $ref: 'common.yml#/$defs/nodeIdString'
        minItems: 1
    required:
      - id

type: object
properties:
  daxVersion:
    $ref: 'common.yml#/$defs/versionString'
  name:
    $ref: 'common.yml#/$defs/filenameSafeString'
  version:
    $ref: 'common.yml#/$defs/versionString'
  hooks:
    $ref: 'common.yml#/$defs/hooks'
  siteCatalog:
    oneOf:
      - $ref: sc-5.0.yml
      - properties:
          $ref:
            type: string
            format: iri
        required: [$ref]
  replicaCatalog:
    oneOf:
      - $ref: 'rc-5.0.yml#/$defs/inlineReplicaCatalog'
# for future work if rc becomes reuseable
#      - properties:
#           $ref:
#             type: string
#             format: iri
#        required: [$ref]
  transformationCatalog:
    oneOf:
      - $ref: 'tc-5.0.yml#/$defs/inlineTransformationCatalog'
# for future work if tc becomes reuseable
#      - properties:
#          $ref:
#            type: string
#            format: iri
#        required: [$ref]
  jobs:
    type: array
    items:
      anyOf:
        - $ref: '#/$defs/job'
        - $ref: '#/$defs/dag'
        - $ref: '#/$defs/dax'
    minItems: 1
  jobDependencies:
    type: array
    items:
      $ref: '#/$defs/parent'
    minItems: 0
required:
    # change to pegasus (pegasus version)
  - daxVersion
  - name
  - jobs
additionalProperties: false
patternProperties:
  ^x-:
    $ref: 'common.yml#/$defs/vendorExtension'
