#!/usr/bin/env python

import sys
import os

if len(sys.argv) != 2:
    print "Usage: %s SUBMIT_DIR" % __file__
    exit(1)

edir = sys.argv[1]

trace = os.path.join(edir, "shadowq.trace")
jslog = os.path.join(edir, "jobstate.log")

js = open(jslog, "r").readlines()
actual_start = int(js[0].split()[0])
actual_finish = int(js[-1].split()[0])
actual_makespan = actual_finish - actual_start

print "Time Step,Actual Finish,Estimated Finish,Abs. Error,Pct. Error"

for l in open(trace, "r"):
    ts, remaining, estimated_finish = l.split()
    ts = float(ts)
    remaining = float(remaining)
    estimated_finish = float(estimated_finish)

    ts = ts - actual_start

    estimated_makespan = estimated_finish - actual_start

    abs_error = abs(estimated_makespan - actual_makespan)

    pct_error = abs_error / actual_makespan

    print "%f,%f,%f,%f,%f" % (ts, actual_makespan, estimated_makespan, abs_error, pct_error)
