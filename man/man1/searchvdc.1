.\" This file or a portion of this file is licensed under the terms of
.\" the Globus Toolkit Public License, found in file GTPL, or at
.\" http://www.globus.org/toolkit/download/license.html. This notice must
.\" appear in redistributions of this file, with or without modification.
.\"
.\" Redistributions of this Software, with or without modification, must
.\" reproduce the GTPL in: (1) the Software, or (2) the Documentation or
.\" some other similar material which is provided with the Software (if
.\" any).
.\"
.\" Copyright 1999-2004 University of Chicago and The University of
.\" Southern California. All rights reserved.
.\"
.\"
.\" $Id$
.\"
.\" Authors: Jens-S. Vöckler, Yong Zhao
.\"
.\"
.TH searchvdc 1 "May, 12th 2005"
.SH NAME
searchvdc \- allows to search and list the VDDB
.SH SYNOPSIS
.B searchvdc
[\-Dprop [..]] [\-d db-prefix][\-l x|t|n] [\-o outputfile] [\-e] [\-E] [\-t tr|dv] [\-n namespace] [\-i name] [\-v version] [\-\-verbose] [\-D def,..] [\-L lod]
.br
.B searchvdc
[\-Dprop [..]] [\-d db-prefix][\-l x|t|n] [\-o outputfile] [\-e] [\-E] [\-t i|o|io] [\-\-verbose] [\-f lfn] [\-F lof]
.br
.B searchvdc
[\-Dprop [..]] \-V
.SH DESCRIPTION
Searches in the database will show the results as textual output similar
to an SQL query output. Alternative output formats encompass VDLt
textual format and VDLx. The tools can also be used to dump the entire
contents of a VDC into a file, e.g. for backups or schema upgrades. 
.PP
Note that the argument set
.BR \-t ,
.BR \-n ,
.BR \-i ,
.BR \-v ,
.BR \-D
and
.BR \-L
and the argument set
.BR \-t ,
.BR \-f
and
.BR \-F
are mutually exclusive.
.SH ARGUMENTS
.TP
.B \-Dprop
The -D options allows an experienced user to override certain properties
which influence the program execution, among them the default location of
the user's properties file and the VDS home location. One may set several
CLI properties by giving this option multiple times.
.I The -D property option(s) must be the first option on the command line. 
A CLI property take precedence over the properties file property 
of the same key.
.TP
.B \-d db-prefix 
.PD 0
.TP
.PD 1
.B \-\-dbase db-prefix
The database prefix is currently unused.
.IP
Default is to use the VDC pointed to by the
.I vds.db.schema
property. If this property is unset, the 
.I SingleFileSchema
becomes the chosen schema, and the property
.I vds.db.schema.file.store
defaults to
.IR $VDS_HOME/var/vds.db ,
the eventual default database file.
.TP
.B \-t tr|dv|all|both
.PD 0
.TP
.PD 1
.B \-\-type tr|dv|all|both
You may limit your search to a subset of definitions, either to
just transformation, using argument
.IR tr ,
or to derivations, using argument
.IR dv .
The arguments are taken in a case-insensitive fashion. Please note
that the argument
.I \-t
is overloaded, and has this semantics only when searching for definitions.
.IP
Default is search in 
.I all 
definitions.
.TP
.B \-n namespace
.PD 0
.TP
.PD 1
.B \-\-namespace namespace
.TP
.B \-i name
.PD 0
.TP
.PD 1
.B \-\-name name
.TP
.B \-v version
.PD 0
.TP
.PD 1
.B \-\-version version
specifies the search for a specific definition. You may specify any
combination of one, two or all three arguments, providing a 
namespace, name and version number respectively. Unspecified pieces
act as wild-card, matching any definition.
.IP
The regular characters underscore (_) and percent (%) are escaped by
the code for the request. The shell joker characters questionmark (?) 
and asterisk (*) are translated into SQL jokers. Only the annotated
VDC schema is searchable this fashion. 
.IP
If you specify none of the option, all definitions match. This will
effectively dump the entire VDC contents. 
.TP
.B \-D def,..
.PD 0
.TP
.PD 1
.B \-\-deflist def,..
This option takes the definition identifier, or possibly
comma-separated list thereof, as argument. The search encompasses all
specified defitions, which may be under-specified. This option may be
specified multiple times. 
.I The non-property -D option must not be the first option on the 
.I command-line, or it will be confused as property setting. 
Alternatively, you can use the long option name. 
.TP
.PD 0
.B \-L fn
.TP
.PD 1
.B \-\-deflist fn
This mode of operation permits to extend beyond commandline length
limitations. The file specified by
.I fn
contains one definition per line, or empty lines. Comments start with a
# and extend to the end of the line. This option may be specified
multiple times. 
.IP
There is no default.
.TP
.B \-t i|o|io|oi
.PD 0
.TP
.PD 1
.B \-\-type i|o|io|oi
You may limit your search to a subset of definitions, either to those
where the LFN is just input, just output, or inout. The arguments are
taken in a case-insensitive fashion. Please note that the argument
.I \-t
is overloaded, and has this semantics only when searching for logical filenames.
.IP
Default is search in 
.I all 
logical filenames.
.TP
.B \-f lfn
.PD 0
.TP
.PD 1
.B \-\-lfn lfn
allow to search for the specified logical filename. The
.I \-t 
argument limits the search to input, output and inout files
respectively. The 
.I \-f 
argument specifies the logical filename. You must specify a one or
both options.
.IP
Default is to list all filenames. 
.TP
.B \-F fn
.PD 0
.TP
.PD 1
.B \-\-filelist fn
This mode of operation permits to extend beyond commandline length
limitations. The file specified by
.I fn
contains one logical filename per line, or empty lines. Comments start
with a # and extend to the end of the line. This option may be specified
multiple times.
.IP
Default is to list all filenames. 
.TP
.B \-l x|t|l
.PD 0
.TP
.PD 1
.B \-\-list x|t|l
This optional argument allows formatting of the findings. The
.I x
option will produce VDLx output, which might be captured into a
file for post-processing. The 
.I t
option produces VDLt output. The
.I l 
option is the default, and produces just the matches found in
the database. 
.IP
Note that only definitions output will be capable of producing either
VDLx or VDLt output.
.IP
Default is a simple textual output of the results as fully-qualified
definition identifiers.
.TP
.B \-o output
.PD 0
.TP
.PD 1
.B \-\-output output
allow to capture results into a separate file. This option is useful in
conjunction with VDLx output mode to dump portions of the VDC into a
file. 
.IP
Default is to produce results on
.IR stdout .
.TP
.B \-V
.PD 0
.TP
.PD 1
.B \-\-version
displays the version of the GriPhyN Virtual Data System you are using.
.TP
.B \-e
.PD 0
.TP
.PD 1
.B \-\-error
In the presence of this flag, an empty result set will return an exit
code of 2. This may be helpful to detect failed searches simply in
scripted applications. The error will only be raised, if the total of
all searches is empty. 
.IP
If the search is guided by only one parameter set (one search upon the
VDC), the modes
.I \-e
and 
.I \-E
are equivalent.
.IP
Default is to return a non-zero exit code only for systematic failures.
.B \-E
.PD 0
.TP
.PD 1
.B \-\-empty
In the presence of this flag
.I and
when using one of the bulk modes, an error is raised on the first search
which did not yield any results. The application will return with an
exit code of 2. 
.IP
If the search is guided by only one parameter set (one search upon the
VDC), the modes
.I \-e
and 
.I \-E
are equivalent.
.IP
Default is to return a non-zero exit code only for systematic failures. 
.TP
.B \-\-verbose
increases the verbosity of messages about what is going on. 
.SH "RETURN VALUE"
Regular and planned program terminations will result in an exit code of 0.
Abnormal termination will result in an exit code of 1. If the \-e or \-E
flag was specified, an empty result set will result in an exit code of 2.
.SH FILES
.TP
.B $VDS_HOME/etc/vdl-1.24.xsd
is the suggested location of the latest XML schema to read the database.
.TP
.B $VDS_HOME/etc/properties
contains the system properties with all configurable options.
.TP
.B $HOME/.vdsrc
contains the user properties with all configurable options.
.TP
.B gvds.jar
contains all compiled Java bytecode to run the GriPhyN Virtual Data System.
.SH "ENVIRONMENT VARIABLES"
.TP
.B $VDS_HOME
is the suggested base directory of your the execution environment.
.TP
.B $JAVA_HOME
should be set and point to a valid location to start the intended Java
virtual machine as
.IR $JAVA_HOME/bin/java .
.TP
.B $CLASSPATH
should be set to contain all necessary files for the execution environment.
Please make sure that your 
.I CLASSPATH
includes the Xerces 2.0.1 classes.
.SH "SEE ALSO"
.BR insertvdc (1),
.BR updatevdc (1),
.BR deletevdc (1).
.SH EXAMPLE
.LP
Please note how the verbosity option affects the messages printed:
.nf
\f(CB
$ searchvdc -t tr
tut::echo

$ searchvdc --verbose -t tr
2005.08.16 13:00:20.795 CDT: [app] found 1 matches total
tut::echo

$ searchvdc --verbose --verbose -t tr 
2005.08.16 13:00:41.524 CDT: [app] searching the database
2005.08.16 13:00:42.230 CDT: [app] found 1 matches total
tut::echo

$ searchvdc --verbose --verbose --verbose -t tr
2005.08.16 13:01:00.016 CDT: [app] searching the database
2005.08.16 13:01:00.019 CDT: [app] wildcard search requested
2005.08.16 13:01:00.720 CDT: [app] found 1 matches total
tut::echo
\fP
.fi
.PP
.nf
\f(CB
$ searchvdc -t dv -n voeckler -l t
DV voeckler::top:1.0->voeckler::preprocess:1.0,1.0(
  a=@{input:"voeckler.f.a"},
  b=[ @{output:"voeckler.f.b1":"true"}, @{output:"voeckler.f.b2":"true"} ] );
DV voeckler::left:1.0->voeckler::findrange:1.0,1.0(
  a1=@{input:"voeckler.f.b1":"true"},
  a2=@{input:"voeckler.f.b2":"true"},
  b=@{output:"voeckler.f.c1":"true"},
  name="left",
  p="0.5" );
DV voeckler::right:1.0->voeckler::findrange:1.0,1.0(
  a1=@{input:"voeckler.f.b1":"true"},
  a2=@{input:"voeckler.f.b2":"true"},
  b=@{output:"voeckler.f.c2":"true"},
  name="right",
  p="1.0" );
DV voeckler::bottom:1.0->voeckler::analyze:1.0,1.0(
  a=[ @{input:"voeckler.f.c1"}, @{input:"voeckler.f.c2"} ],
  b=@{output:"voeckler.f.d"} );
DV voeckler::hello->tut::echo(
  file=@{output:"voeckler.hw.txt"},
  message="Hello World" );

$ echo $?
0

$ searchvdc -e -t dv -n bogus -l t
$ echo $?
2
\fP
.fi
.PP
The next example illustrates how to search with and without jokers, if
employing the annotated VDC schema. Please note how to escape the
shell-style search jokers from the shell.
.nf
\f(CB
$ searchvdc -i sdssNeoGridTar_5402_40_1
sdssNeoGridTar_5402_40_1->sdssneogridtar::neojobwrappertar:1,1

$ searchvdc -i 'sdssNeoGridTar?5402?40?1'
sdssNeoGridTar-5402-40-1->sdssneogridtar::neojobwrappertar:1,1
sdssNeoGridTar_5402_40_1->sdssneogridtar::neojobwrappertar:1,1
\fP
.fi
.SH RESTRICTIONS
Plenty. 
.SH AUTHORS
Jens-S. Vöckler <voeckler at cs dot uchicago dot edu>,
.\"Jens-S. V\*:ockler 
.br
Mike Wilde <wilde at mcs dot anl dot gov>,
.br
Yong Zhao <yongzh at cs dot uchicago dot edu>.
.PP
Chimera
.B http://www.griphyn.org/chimera/
.br
GriPhyN
.BR http://www.griphyn.org/
