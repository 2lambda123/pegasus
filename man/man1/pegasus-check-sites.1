.\" This file or a portion of this file is licensed under the terms of
.\" the Globus Toolkit Public License, found in file GTPL, or at
.\" http://www.globus.org/toolkit/download/license.html. This notice must
.\" appear in redistributions of this file, with or without modification.
.\" 
.\" Redistributions of this Software, with or without modification, must
.\" reproduce the GTPL in: (1) the Software, or (2) the Documentation or
.\" some other similar material which is provided with the Software (if
.\" any).
.\" 
.\" Copyright 1999-2004 University of Chicago and The University of
.\" Southern California. All rights reserved.
.\" 
.\" $Id$
.\" 
.TH "pegasus-check-sites" "1" "1.3.9" "Jens-S. Vöckler" "GriPhyN PEGASUS Planner"
.SH "NAME"
.LP 
pegasus\-check\-sites \- sanitize a site catalog.
.SH "SYNTAX"
.LP 
.B pegasus\-check\-sites [\-Dprops] [\-\-level int] [\-\-debug|\-d lvl] [\-\-timeout k=v] [\-\-tc|\-t fn] [\-\-sc|\-s fn] [\-\-tc\-style|\-T mode] [\-\-sc\-style|\-S mode] 
.LP 
.B pegasus\-get\-sites \-\-help
.SH "DESCRIPTION"
.LP 
For the site catalog (SC) and transformation catalog (TC) generated by
.I pegasus\-get\-sites
this tool sanitizes the site catalog by removing invalid sites. An
invalid site is any site that exhibits strange and adverse behavior. A
series of checks are performed to a chosen intensity. 
.SH "OPTIONS"
.TP 
.B  \-Dprop
The \-D option in conjunction with properties allows an experienced user
to override certain properties which influence the program execution,
among them the default location of the user's properties file and the
catalog locations. One may set several CLI properties by giving this
option multiple times. 
.I The \-D option(s) must be the first option on the command line. 
Properties on the command\-line take precedence over the file\-based
properties of the same key.
.TP 
.B \-\-level int
This is the major option to chose a test intensity. There are currently
four levels supported, where a more intense (deeper) level includes
checks from a less intense (lighter) level.
.IP
.I ping
level just checks that a remote gatekeeper service can be contacted via
TCP, and that the remote gridftp service can be contacted via TCP. No
authentication will be attempted at this level. The checks do not
include authentication tests against the remote gatekeeper. Hence, it's
results are not sufficient to assume that you will be able to run jobs
on the given site.
.IP
.I light
level just add authentication checks on top of successful ping probes.
All (regular) job managers are authenticated with, and a simple 
.I uberftp
based gridftp authentication is attempted. Sites succeeding at this
level imply that is a distinct chance that one can run grid jobs in
general on the site. 
.IP
.I medium
level is the default level. It includes the authentication checks of the
light level, and adds real grid tests. The additional tests feature
an attempted gridftp transfer, and running a simple fork job on the
gatekeeper. 
.IP
.I deep
level is under development! Besides all tests of the medium level, it
adds a batch job to the checks. The batch job includes a script that
checks the availability of all transformations defined in the TC for
that site.
.TP 
.B \-\-debug lvl
.PD 0
.TP 
.PD 1
.B \-d lvl
adjusts the debug level. The debug level 
.I lvl
is a bit-wise OR, please refer to the 
.B \-\-help
option for details.
.IP 
The default debug level is 0x05.
.TP 
.B \-\-timeout k=v
This option permits to set specific time outs (in seconds) for each
major function that is checked. It limits the time that a user is
willing to wait for a sub-operation to return successfully before it
times out (and thus fails). Currently, different sub-checks have
different timeouts.
.IP
The 
.I all
special function permits to set the same timeout for all known
functionalities. If you use the
.I all
function before other functions, you can set one time-out to start with,
and then selectively adjust it for specific functions.
.IP
The
.B \-\-timeout
option may be specified multiple times, once for each function equals
timeout pair.
.IP
For a set of available function names and their respective default
timeouts, please refer to the 
.B \-\-help
output.
.TP 
.B \-\-tc fn
.PD 0
.TP 
.PD 1
.B \-t fn
This option permits to override the location of the transformation catalog.
Existing files will be backed up.
.IP 
The default is to read the location from property 
.IR pegasus.tc.file .
If it does not exist, the default location 
.I $PEGASUS_HOME/var/tc.data
is assumed.
.TP 
.B \-\-sc fn
.PD 0
.TP 
.PD 1
.B \-s fn
This option permits to override the location of the site catalog.
Existing files will be backed up.
.IP 
The default is to read the location from property
.IR pegasus.sc.file .
If it does not exist, the default location
.I $PEGASUS_HOME/var/sites.txt
or
.I $PEGASUS_HOME/var/sites.xml 
is assumed, depending on the site catalog mode.
.TP 
.B \-\-tc\-style mode
.PD 0
.TP
.PD 1
.B \-T mode
This option sets the mode or formatting of the transformation catalog. 
Available styles include
.I old
for the deprecated 4\-column textual format,
.I new
for the 6\-column textual format, and 
.I pegasus
for the database\-driven format.
.IP 
Default is to read the format option from the property
.I pegasus.tc
or
.IR pegasus.tc.mode .
The Pegasus modes 
.IR single ,
.I multiple
and
.I OldFile
translate into the Euryale style
.IR old .
The recommended Pegasus mode 
.I File
translates into Euryale style 
.IR new .
The Pegasus mode
.I Database
translates into Euryale style
.IR pegasus .
Default style in the absence of properties is
.IR new .
.TP 
.B \-\-sc\-style mode
.PD 0
.TP
.PD 1
.B \-S mode
This option sets the mode or formatting of the site catalog. Available styles
include
.I old
for the deprecated multi\-column site catalog,
.I new
for the multi\-line site catalog, and
.I xml
for the XML site catalog.
.IP 
Default is to read the format option from the property
.I pegasus.sc
or 
.IR pegasus.pool.mode .
The dysfunctional Pegasus modes
.I single
and
.I multiple
map to the Euryale style
.IR old ,
Pegasus mode
.I Text
maps to Euryale style
.I new 
and Pegasus mode
.I XML
maps to Euryale style 
.IR xml .
Default style in the absence of properties is
.IR xml .
.TP 
.B \-\-help
The help option shows a concise help about the available command\-line
options and their default values. 
.SH "FILES"
.LP 
.TP 
.B $PEGASUS_HOME/var/sites.xml
is the default location where the default site catalog will be produced,
using the default style
.IR xml .
.TP 
.B $PEGASUS_HOME/var/sites.txt
is the alternative location for the produced site catalog, if the style
is not
.IR xml .
.TP 
.B $PEGASUS_HOME/var/tc.data
is the default location for the transformation catalog, unless the
database style
.I pegasus
was chosen.
.SH "PROPERTIES"
.LP 
Properties are read and evaluated according to the PEGASUS property
precedence rules. Please refer to the property documentation for
in\-depth description of properties and their effects.
.TP 
.B pegasus.sc
.PD 0
.TP
.PD 1
.B pegasus.pool.mode
This property determines the default formatting in which the site
catalog is generated. Its effect can be overwritten with the
\-\-sc\-style command\-line option. The alternatives are ordered by
preference. 
.TP 
.B pegasus.sc.file
.PD 0
.TP
.PD 1
.B pegasus.pool.file
This property determines the default location where a file\-based site
catalog is generated. Its effect can be overwritten with the \-\-sc
command\-line option. The alternatives are ordered by preference.
.TP 
.B pegasus.tc
.PD 0
.TP
.PD 1
.B pegasus.tc.mode
This property determines the default formatting in which the
transformation catalog is generated. Its effect can be overwritten with
the \-\-sc\-style command\-line option. The alternatives are ordered by
preference.
.TP 
.B pegasus.tc.file
This property determines the default location in where a file\-based
transformation catalog is generated. Its value is unused, if database
access is chosen. The effect can be overwritten using the \-\-tc
command\-line option.
.SH "ENVIRONMENT VARIABLES"
.LP 
.TP 
.B PEGASUS_HOME
points to the base of the PEGASUS Planner (PEGASUS) installation.
.TP 
.B PERL5LIB
contains the PEGASUS Perl modules required to access the various catalogs. 
.SH "EXAMPLE"
.LP 
.nf
\f(CB
$ pegasus-get-sites --tc T --sc S 
 ...
$ pegasus-check-sites --tc T --sc S --level light --timeout all=90       
 ...
\fP
.fi
.LP
It is beneficial to explicitely specify the location of all catalogs.
Otherwise, the properties are examined for the correct location.
.SH "AUTHORS"
.LP
Jens\-S. Vöckler <voeckler at cs dot uchicago dot edu>
.PP 
PEGASUS
.B http://pegasus.isi.edu
.br 
GriPhyN
.BR http://www.griphyn.org/
.SH "SEE ALSO"
.LP 
pegasus\-get\-sites(1)
