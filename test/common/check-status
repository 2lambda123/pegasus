#!/bin/bash                                                                                                                                                                                                                                                       
echo "CURRENT DIR is " `pwd`
echo "Checking status "

function update_status
{
   STATUS=`pegasus-status --noqueue | tail -1 | sed 's/[:\(\)]/ /g'| awk '{print $5}'`
}

sleep 1m
update_status

echo STATUS is "$STATUS"

while [ "$STATUS" = "Running" -o "$STATUS" = "" -o "$STATUS" = "Uknown"  ]; do
    sleep 1m
    update_status
    echo "#"
done

if [ "$STATUS" = "Success" ]; then
    echo "*** Workflow finished succesfully ***"
    exit 0
else
    echo "*** Workflow failed ***"
    exit 1
fi