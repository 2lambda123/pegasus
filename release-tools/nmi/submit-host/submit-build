#!/bin/bash

VERSION="$1"
if [ "x$VERSION" = "x" ]; then
    echo "Please specify a SVN version to checkout. Examples:"
    echo "  ./submit-build trunk"
    echo "  ./submit-build branches/2.4.1"
    echo "  ./submit-build tags/2.4.0"
    exit 1
fi

EMAIL="$2"
if [ "x$EMAIL" = "x" ]; then
    echo "Please specify a notification email address as second arguent."
    echo "Example:"
    echo "  ./submit-build trunk rynge@isi.edu"
    exit 1
fi

# nmi env
export _NMI_HOME=$HOME
export _NMI_HOSTNAME=$HOSTNAME
export _NMI_SUBMITDIR=$PWD

cat >cmdfile <<EOF
# DO NOT EDIT - this file is automatically generated

project = Pegasus
project_release = $VERSION
component = $VERSION - Full build
component_version = $VERSION
description = Pegasus Build and Test
run_type = build

platform_type = nmi

inputs = remote-declare.scp, remote-post.scp, build-pegasus.scp, platform-post.scp, ant.url, pegasus.svn

remote_declare = remote-declare
remote_task = build-pegasus
remote_post = remote-post
platform_post = platform-post

remote_default_timeout=2h

platforms = x86_64_deb_5.0, x86_64_deb_6.0, x86_64_macos_10.7, x86_64_rhap_5.8, x86_64_rhap_6.3, x86_rhap_5.8, x86_rhap_6.3

#prereqs =  apache-ant-1.7.0
#prereqs =  wget-1.9.1, apache-ant-1.7.0

#prereqs_x86_64_rhap_6.2 = ant-1.7.1-13.el6.x86_64 

notify=$EMAIL
EOF

cat >pegasus.svn <<EOF
# DO NOT EDIT - this file is automatically generated
method     = svn 
url        = https://pegasus.isi.edu/svn/pegasus/$VERSION pegasus
EOF

nmi_submit --must-match --notify-fail-only  cmdfile


