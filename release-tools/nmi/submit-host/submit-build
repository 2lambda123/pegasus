#!/bin/bash

VERSION="$1"
if [ "x$VERSION" = "x" ]; then
    echo "Please specify a SVN version to checkout. Examples:"
    echo "  ./submit-build trunk"
    echo "  ./submit-build branches/2.4.1"
    echo "  ./submit-build tags/2.4.0"
    exit 1
fi

EMAIL="$2"
if [ "x$EMAIL" = "x" ]; then
    echo "Please specify a notification email address as second arguent."
    echo "Example:"
    echo "  ./submit-build trunk rynge@isi.edu"
    exit 1
fi

# nmi env
export _NMI_HOME=$HOME
export _NMI_HOSTNAME=$HOSTNAME
export _NMI_SUBMITDIR=$PWD

cat >cmdfile <<EOF
# DO NOT EDIT - this file is automatically generated

project = Pegasus
project_release = $VERSION
component = Mapper/Worker/WMS
component_version = $VERSION
description = Pegasus Build and Test
run_type = build

platform_type = nmi

inputs = remote-declare.scp, remote-post.scp, condor.nmi, build-pegasus.scp, platform-post.scp, pegasus.svn

remote_declare = remote-declare
remote_task = build-pegasus
remote_post = remote-post
platform_post = platform-post

remote_default_timeout=2h

platforms = ia64_sles_9, x86_64_deb_5.0, x86_64_rhap_5, x86_64_rhas_4, x86_64_sles_9, x86_deb_4.0, x86_deb_5.0, x86_rhap_5, x86_rhas_4

prereqs =  apache-ant-1.7.0
#prereqs =  wget-1.9.1, apache-ant-1.7.0

prereqs_ia64_sles_9 = java-6u13
prereqs_ppc_aix_5.3 = ibm-java-1.5.0-sr7, vac-6, vacpp-6
prereqs_ppc_macos_10.4 = java-1.5.0_05
prereqs_sun4u_sol_5.8 = java-6u13
prereqs_sun4u_sol_5.9 = java-6u13
prereqs_sun4u_sol_5.10 = java-6u13
prereqs_x86_64_deb_4.0 = java-6u13
prereqs_x86_64_deb_5.0 = java-6u13
prereqs_x86_64_fc_5 = java-6u13
prereqs_x86_64_fedora_8 = java-6u13
prereqs_x86_64_fedora_9 = java-6u13
prereqs_x86_64_fedora_11 = java-6u13
prereqs_x86_64_macos_10.5 = java-1.5.0_13
prereqs_x86_64_rhap_5.3 = java-6u13
prereqs_x86_64_rhap_5.2 = java-6u13
prereqs_x86_64_rhap_5 = java-6u13
prereqs_x86_64_rhas_3 = java-6u13
prereqs_x86_64_rhas_4 = java-6u13
prereqs_x86_64_sles_9 = java-6u13
prereqs_x86_64_ubuntu_8.04.3 = java-6u13
prereqs_x86_deb_4.0 = java-6u13
prereqs_x86_deb_5.0 = java-6u13
prereqs_x86_fc_5 = java-6u13
prereqs_x86_macos_10.4 = java-1.5.0_06
prereqs_x86_rhap_5 = java-6u13
prereqs_x86_rhas_3 = java-6u13
prereqs_x86_rhas_4 = java-6u13
prereqs_x86_sles_9 = java-6u13
prereqs_x86_sl_4.4 = java-6u13
prereqs_x86_suse_10.2 = java-6u13
prereqs_x86_ubuntu_5.10 = java-6u13

notify=$EMAIL
EOF

cat >pegasus.svn <<EOF
# DO NOT EDIT - this file is automatically generated
method     = svn 
url        = https://pegasus.isi.edu/svn/pegasus/$VERSION pegasus
EOF

nmi_submit --must-match --notify-fail-only  cmdfile


